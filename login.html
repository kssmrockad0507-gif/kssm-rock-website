<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KSSM Rock Login</title>

<style>
body {
    margin: 0;
    padding: 0;
    background: linear-gradient(to bottom, #7EC8E3, #C4EBFF);
    font-family: Arial;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.login-box {
    background: white;
    padding: 25px;
    border-radius: 20px;
    width: 85%;
    max-width: 380px;
    text-align: center;
    box-shadow: 0px 4px 14px rgba(0,0,0,0.3);
}

.login-box h2 {
    margin-bottom: 20px;
}

.google-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    background: #4285F4;
    color: white;
    padding: 12px;
    border-radius: 8px;
    font-size: 18px;
    cursor: pointer;
}
.google-btn img {
    width: 24px;
}
</style>
</head>

<body>

<div class="login-box">
    <h2>Welcome to KSSM ROCK Tamil</h2>

    <div class="google-btn" onclick="googleLogin()">
        <img src="https://cdn-icons-png.flaticon.com/512/281/281764.png">
        Continue with Google
    </div>
</div>

<script type="module">

// Firebase IMPORTS
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, doc, setDoc }
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// FIREBASE CONFIG
const firebaseConfig = {
    apiKey: "AIzaSyCBgBWfpUbtlPbvCfDr6N1_L2svtJglfhM",
    authDomain: "kssm-rock-tam-ad.firebaseapp.com",
    projectId: "kssm-rock-tam-ad",
    storageBucket: "kssm-rock-tam-ad.firebasestorage.app",
    messagingSenderId: "28268633766",
    appId: "1:28268633766:web:f6ee57eaf56f7cbd37de67"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);


// If already logged in â†’ Move home
onAuthStateChanged(auth, (user) => {
    if (user) {
        window.location.href = "home.html";
    }
});


// GOOGLE LOGIN (REDIRECT)
function googleLogin() {
    const provider = new GoogleAuthProvider();
    signInWithRedirect(auth, provider);
}


// When user returns after selecting Google account
getRedirectResult(auth)
    .then(async (result) => {
        if (result) {
            const user = result.user;

            // Save user in database
            await setDoc(doc(db, "users", user.uid), {
                name: user.displayName,
                email: user.email,
                coins: 0
            }, { merge: true });

            window.location.href = "home.html";
        }
    })
    .catch((error) => {
        console.log("Login Error:", error.message);
    });

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KSSM Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg1:#0e5d63;
  --bg2:#07404b;
  --card:#ffffff;
  --accent:#195c63;
  --danger:#d9534f;
  --success:#28a745;
}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  min-height:100vh;
  color:#fff;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:16px;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.brand{font-size:22px;font-weight:bold;}
.btn{
  border:none;
  border-radius:8px;
  padding:8px 14px;
  cursor:pointer;
}
.btn-main{background:var(--accent);color:#fff;}
.btn-ghost{background:transparent;color:#fff;border:1px solid rgba(255,255,255,.3);}
.btn-danger{background:var(--danger);color:#fff;}
.btn-success{background:var(--success);color:#fff;}

.card{
  background:var(--card);
  color:#000;
  border-radius:14px;
  padding:16px;
  margin-top:16px;
}

.tabs{
  display:flex;
  gap:8px;
  margin-top:12px;
  flex-wrap:wrap;
}
.tabs button{
  border:none;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  background:#eee;
}
.tabs button.active{
  background:var(--accent);
  color:#fff;
}

.field{
  width:100%;
  padding:8px;
  margin-top:8px;
  border-radius:8px;
  border:1px solid #ccc;
}
.list{
  max-height:300px;
  overflow:auto;
  margin-top:10px;
}
.notice{
  background:#f4f4f4;
  padding:10px;
  border-radius:8px;
  margin-bottom:8px;
}
.hidden{display:none;}
.small{font-size:13px;color:#555;}
.chip{
  padding:6px 12px;
  border-radius:20px;
  background:#fff;
  color:#000;
}
</style>
</head>

<body>
<div class="container">

<!-- HEADER -->
<div class="header">
  <div class="brand">KSSM Admin Panel</div>
  <div>
    <span id="signedAs" class="small">Not signed</span>
    <button id="loginBtn" class="btn btn-main">Sign in with Google</button>
    <button id="logoutBtn" class="btn btn-ghost hidden">Sign Out</button>
  </div>
</div>

<!-- ADMIN AREA -->
<div id="adminArea" class="hidden">

<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <div>
      <h2>Welcome Admin</h2>
      <div class="small">Full control panel</div>
    </div>
    <div id="maintenanceChip" class="chip">Maintenance : OFF</div>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <button class="active" data-tab="dashboard">Dashboard</button>
    <button data-tab="users">Users</button>
    <button data-tab="coins">Coins</button>
    <button data-tab="codes">Redeem Codes</button>
    <button data-tab="history">History</button>
    <button data-tab="settings">Settings</button>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="tab">
    <div class="card">
      <h3>Statistics</h3>
      <div id="statUsers">Users: —</div>
      <div id="statCodes">Codes: —</div>
      <div id="statRedeemed">Redeemed: —</div>
    </div>
  </div>

  <!-- USERS -->
  <div id="users" class="tab hidden">
    <div class="card">
      <h3>All Users</h3>
      <button onclick="loadUsers()" class="btn btn-main">Load Users</button>
      <div id="usersList" class="list"></div>
    </div>
  </div>

  <!-- COINS -->
  <div id="coins" class="tab hidden">
    <div class="card">
      <h3>Modify Coins</h3>
      <input id="coinUid" class="field" placeholder="User UID">
      <input id="coinAmount" class="field" placeholder="Amount (+ / -)">
      <button onclick="updateCoins()" class="btn btn-main" style="margin-top:10px;">Update</button>
    </div>
  </div>

  <!-- CODES -->
  <div id="codes" class="tab hidden">
    <div class="card">
      <h3>Redeem Codes</h3>
      <select id="codeCategory" class="field">
        <option value="10rs">10rs</option>
        <option value="20rs">20rs</option>
        <option value="50rs">50rs</option>
        <option value="100rs">100rs</option>
      </select>
      <button onclick="loadCodes()" class="btn btn-main" style="margin-top:10px;">Load</button>
      <div id="codesList" class="list"></div>
    </div>
  </div>

  <!-- HISTORY -->
  <div id="history" class="tab hidden">
    <div class="card">
      <h3>Redeem History</h3>
      <button onclick="loadHistory()" class="btn btn-main">Load</button>
      <div id="historyList" class="list"></div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div id="settings" class="tab hidden">
    <div class="card">
      <h3>Settings</h3>
      <button onclick="toggleMaintenance()" class="btn btn-main">Toggle Maintenance</button>
    </div>
  </div>

</div>
</div>

<div id="notAdmin" class="card hidden">
  <h3>Access Denied</h3>
  <p>You are not an admin.</p>
</div>

</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, getDocs, runTransaction } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCBgBWfpUbtlPbvCfDr6N1_L2svtJglfhM",
  authDomain: "kssm-rock-tam-ad.firebaseapp.com",
  projectId: "kssm-rock-tam-ad",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

/* AUTH */
loginBtn.onclick = ()=>signInWithPopup(auth,provider);
logoutBtn.onclick = ()=>signOut(auth);

onAuthStateChanged(auth, async user=>{
  if(!user) return;
  signedAs.innerText = user.email;
  loginBtn.classList.add("hidden");
  logoutBtn.classList.remove("hidden");

  const u = await getDoc(doc(db,"users",user.uid));
  if(u.exists() && u.data().isAdmin){
    adminArea.classList.remove("hidden");
    loadStats();
  }else{
    notAdmin.classList.remove("hidden");
  }
});

/* TABS */
document.querySelectorAll(".tabs button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".tabs button").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    document.querySelectorAll(".tab").forEach(t=>t.classList.add("hidden"));
    document.getElementById(b.dataset.tab).classList.remove("hidden");
  };
});

/* FUNCTIONS */
async function loadStats(){
  const u=await getDocs(collection(db,"users"));
  statUsers.innerText="Users: "+u.size;
}
async function loadUsers(){
  usersList.innerHTML="";
  const snap=await getDocs(collection(db,"users"));
  snap.forEach(d=>{
    usersList.innerHTML+=`<div class="notice">${d.data().email||"no email"}</div>`;
  });
}
async function updateCoins(){
  const uid=coinUid.value;
  const amt=Number(coinAmount.value);
  await runTransaction(db,async tx=>{
    const ref=doc(db,"users",uid);
    const s=await tx.get(ref);
    tx.update(ref,{coins:(s.data().coins||0)+amt});
  });
  alert("Coins updated");
}
async function loadCodes(){
  codesList.innerHTML="";
  const cat=codeCategory.value;
  const snap=await getDocs(collection(db,"redeemCategories",cat,"codes"));
  snap.forEach(d=>{
    codesList.innerHTML+=`<div class="notice">${d.data().code}</div>`;
  });
}
async function loadHistory(){
  historyList.innerHTML="";
  const snap=await getDocs(collection(db,"redeemCodes"));
  snap.forEach(d=>{
    historyList.innerHTML+=`<div class="notice">${d.data().code}</div>`;
  });
}
async function toggleMaintenance(){
  alert("Maintenance toggle logic here");
}
</script>
</body>
  </html>

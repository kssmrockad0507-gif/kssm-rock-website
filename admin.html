<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KSSM Admin Panel (Google Login)</title>
  <style>
    body{margin:0;font-family:Arial,sans-serif;background:linear-gradient(180deg,#0e5d63,#07404b);color:#fff;}
    .wrap{max-width:960px;margin:auto;padding:16px;}
    .card{background:#fff;color:#000;padding:16px;border-radius:12px;margin-bottom:16px;}
    .btn{cursor:pointer;background:linear-gradient(180deg,#195c63,#0d434a);color:#fff;border:none;padding:10px 12px;border-radius:8px;font-weight:700;}
    .danger{background:#d9534f;}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card" id="authCard">
    <h2>KSSM Admin Login</h2>
    <button id="googleSignIn" class="btn">Continue with Google</button>
    <button id="signOutBtn" class="btn danger" style="display:none;">Sign Out</button>
    <div id="adminInfo" style="margin-top:10px;display:none;">Signed in as <b id="adminEmail"></b></div>
  </div>

  <div class="card" id="adminPanel" style="display:none;">
    <h2>Welcome Admin</h2>
    <p>All admin controls (Users, Coins, Redeem, etc.) appear here once youâ€™re logged in.</p>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ðŸ”¥ Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyCBgBWfpUbtlPbvCfDr6N1_L2svtJglfhM",
  authDomain: "kssm-rock-tam-ad.firebaseapp.com",
  projectId: "kssm-rock-tam-ad",
  storageBucket: "kssm-rock-tam-ad.firebasestorage.app",
  messagingSenderId: "28268633766",
  appId: "1:28268633766:web:f6ee57eaf56f7cbd37de67"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

/* Elements */
const signInBtn = document.getElementById("googleSignIn");
const signOutBtn = document.getElementById("signOutBtn");
const adminPanel = document.getElementById("adminPanel");
const adminInfo = document.getElementById("adminInfo");
const adminEmail = document.getElementById("adminEmail");

/* Google Sign-In */
signInBtn.addEventListener("click", async () => {
  try {
    await signInWithPopup(auth, provider);
  } catch (e) {
    alert("Google Sign-in Failed: " + e.message);
  }
});

/* Sign-Out */
signOutBtn.addEventListener("click", async () => {
  await signOut(auth);
});

/* Auth State */
onAuthStateChanged(auth, async (user) => {
  if (user) {
    const uid = user.uid;
    const docRef = doc(db, "users", uid);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists() && docSnap.data().isAdmin === true) {
      signInBtn.style.display = "none";
      signOutBtn.style.display = "inline-block";
      adminInfo.style.display = "block";
      adminPanel.style.display = "block";
      adminEmail.innerText = user.email;
    } else {
      alert("You are not authorized as Admin!");
      await signOut(auth);
    }
  } else {
    signInBtn.style.display = "inline-block";
    signOutBtn.style.display = "none";
    adminInfo.style.display = "none";
    adminPanel.style.display = "none";
  }
});
</script>
</body>
</html>

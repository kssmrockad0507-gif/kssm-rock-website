<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KSSM ROCK ‚Äì Math Puzzle</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: linear-gradient(180deg, #0e5d63, #07404b);
        font-family: Arial, sans-serif;
        color: white;
    }

    .topBar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        font-size: 20px;
    }

    .back { font-size: 25px; cursor: pointer; }

    .coinBox {
        background: white;
        color: black;
        display: flex;
        align-items: center;
        padding: 6px 15px;
        border-radius: 20px;
        font-weight: bold;
    }

    .coinBox img {
        width: 22px;
        margin-right: 5px;
    }

    .card {
        width: 85%;
        margin: auto;
        margin-top: 10px;
        background: white;
        border-radius: 25px;
        padding: 20px;
        color: black;
        text-align: center;
    }

    .questionBox {
        background: #d9e3e6;
        padding: 35px;
        border-radius: 20px;
        margin-top: 10px;
        font-size: 30px;
        font-weight: bold;
    }

    .ans {
        width: 80%;
        margin: auto;
        background: linear-gradient(180deg, #195c63, #0d434a);
        padding: 18px;
        text-align: center;
        border-radius: 15px;
        margin-top: 20px;
        font-size: 25px;
        font-weight: bold;
        cursor: pointer;
        color: white;
    }

    .adBox {
        width: 90%;
        margin: auto;
        margin-top: 25px;
        background: white;
        height: 180px;
        border-radius: 15px;
    }

    #overlayScreen {
        display: none;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.75);
        position: fixed;
        top: 0;
        left: 0;
        color: white;
        text-align: center;
        padding-top: 200px;
        font-size: 28px;
    }

    #claimBtn {
        margin-top: 25px;
        background: white;
        color: black;
        padding: 12px 30px;
        border-radius: 12px;
        font-size: 22px;
        cursor: pointer;
    }
</style>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

</head>
<body>

<div class="topBar">
    <div class="back" onclick="history.back()">‚Üê</div>
    <div style="font-size:22px;">Math Puzzle</div>
    <div class="coinBox">
        <img src="https://i.imgur.com/4xP3GZp.png">
        <span id="coinCount">0</span>
    </div>
</div>

<div class="card">
    <div class="questionBox" id="questionText">Loading...</div>
</div>

<div id="ansArea"></div>

<div class="adBox"></div>

<div id="overlayScreen"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCBgBWfpUbtlPbvCfDr6N1_L2svtJglfhM",
  authDomain: "kssm-rock-tam-ad.firebaseapp.com",
  projectId: "kssm-rock-tam-ad",
  storageBucket: "kssm-rock-tam-ad.firebasestorage.app",
  messagingSenderId: "28268633766",
  appId: "1:28268633766:web:f6ee57eaf56f7cbd37de67"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let userUID = null;
let coins = 0;
let dailyCount = 0;
const DAILY_LIMIT = 15;

// Question List (5 questions)
let questions = [
  { q: "3 + 5 = ?", a: 8, o1: 8, o2: 9 },
  { q: "Identify the letter: A", a: "A", o1: "A", o2: "B" },
  { q: "10 - 4 = ?", a: 6, o1: 6, o2: 5 },
  { q: "Which is a vowel?", a: "E", o1: "E", o2: "K" },
  { q: "2 √ó 6 = ?", a: 12, o1: 12, o2: 10 }
];

function randomQuestion() {
  return questions[Math.floor(Math.random() * questions.length)];
}

let current = null;

auth.onAuthStateChanged(async (user) => {
    if (user) {
        userUID = user.uid;

        const ref = db.collection("users").doc(userUID);
        const snap = await ref.get();

        if (snap.exists) {
            coins = snap.data().coins || 0;
            dailyCount = snap.data().dailyCount || 0;
        } else {
            ref.set({ coins: 0, dailyCount: 0 });
        }

        document.getElementById("coinCount").innerText = coins;

        loadNewQuestion();
    }
});

// Load next random question
function loadNewQuestion() {
    current = randomQuestion();
    document.getElementById("questionText").innerText = current.q;

    document.getElementById("ansArea").innerHTML = `
        <div class="ans" onclick="checkAnswer('${current.o1}')">${current.o1}</div>
        <div class="ans" onclick="checkAnswer('${current.o2}')">${current.o2}</div>
    `;
}

function checkAnswer(ans) {

    if (dailyCount >= DAILY_LIMIT) {
        showOverlay("Today Limit is Over! ‚ùå<br><br>Come back Tomorrow ‚ù§Ô∏è");
        return;
    }

    if (ans == current.a) {
        showOverlay("Correct Answer! üéâ<br><br><button id='claimBtn' onclick='startAd()'>Continue</button>");
    } else {
        alert("Wrong Answer ‚ùå");
    }
}

function showOverlay(html) {
    const o = document.getElementById("overlayScreen");
    o.style.display = "block";
    o.innerHTML = html;
}

function startAd() {
    let sec = 10;
    showOverlay("Showing Ad‚Ä¶ " + sec + " sec");

    let timer = setInterval(() => {
        sec--;
        showOverlay("Showing Ad‚Ä¶ " + sec + " sec");

        if (sec <= 0) {
            clearInterval(timer);
            showClaimScreen();
        }
    }, 1000);
}

function showClaimScreen() {
    showOverlay(`
        +10 Coins Added! üéâ<br><br>
        <button id="claimBtn" onclick="claimNow()">Claim</button>
    `);
}

async function claimNow() {

    dailyCount += 1;
    coins += 10;

    await db.collection("users").doc(userUID).update({
        coins: coins,
        dailyCount: dailyCount
    });

    document.getElementById("coinCount").innerText = coins;
    document.getElementById("overlayScreen").style.display = "none";

    loadNewQuestion();
}
</script>

</body>
</html>

{"id":"48327","variant":"standard"}
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KSSM Task</title>

<style>
body {
    margin: 0;
    padding: 0;
    background: linear-gradient(to bottom, #8FD3FF, #D7F3FF);
    font-family: Arial;
}

.container {
    padding: 20px;
    text-align: center;
}

.main-box {
    margin-top: 40px;
    background: white;
    padding: 25px;
    border-radius: 18px;
    font-size: 22px;
    font-weight: bold;
    box-shadow: 0px 4px 12px rgba(0,0,0,0.2);
}

.count {
    background: #0077FF;
    color: white;
    padding: 10px;
    margin-top: 20px;
    border-radius: 12px;
    font-size: 20px;
}

.answer-btn {
    margin-top: 20px;
    padding: 12px 20px;
    background: #00A82D;
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 20px;
    cursor: pointer;
}

#adBox, #claimBox {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.75);
    justify-content: center;
    align-items: center;
}

.ad-content, .claim-content {
    background: white;
    padding: 25px;
    border-radius: 18px;
    text-align: center;
    width: 80%;
}

.claim-btn {
    margin-top: 20px;
    padding: 12px 20px;
    background: #FFA500;
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 20px;
    cursor: pointer;
}
</style>
</head>

<body>

<div class="container">

    <div class="main-box">
        Todayâ€™s Question:<br><br>
        <b>What is 10 + 10 ?</b>
    </div>

    <div class="count">
        Attempts Left: <span id="leftCount">15</span>/15
    </div>

    <button class="answer-btn" onclick="submitAnswer()">Submit Answer</button>

</div>

<!-- AD POPUP -->
<div id="adBox">
    <div class="ad-content">
        <h2>Advertisement</h2>
        <p>Your ad is playing...</p>
        <button onclick="closeAd()">Close Ad</button>
    </div>
</div>

<!-- CLAIM POPUP -->
<div id="claimBox">
    <div class="claim-content">
        <h2>+10 Coins Earned!</h2>
        <button class="claim-btn" onclick="claimCoins()">Claim</button>
    </div>
</div>


<script type="module">

// Firebase IMPORTS
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } 
from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyCBgBWfpUbtlPbvCfDr6N1_L2svtJglfhM",
    authDomain: "kssm-rock-tam-ad.firebaseapp.com",
    projectId: "kssm-rock-tam-ad",
    storageBucket: "kssm-rock-tam-ad.firebasestorage.app",
    messagingSenderId: "28268633766",
    appId: "1:28268633766:web:f6ee57eaf56f7cbd37de67"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let attemptsLeft = 15;
let currentUser = null;

onAuthStateChanged(auth, async (user) => {
    if (!user) {
        window.location.href = "login.html";
        return;
    }
    currentUser = user;
});


// Question Answer Click
function submitAnswer(){
    if(attemptsLeft <= 0){
        alert("Today's tasks completed!");
        return;
    }

    // Open Ad
    document.getElementById("adBox").style.display = "flex";
}


// Close Ad
function closeAd(){
    document.getElementById("adBox").style.display = "none";

    // Show Claim UI
    document.getElementById("claimBox").style.display = "flex";
}


// Claim Coins
async function claimCoins(){
    document.getElementById("claimBox").style.display = "none";

    attemptsLeft--;
    document.getElementById("leftCount").innerText = attemptsLeft;

    // Update coins in Firestore
    const ref = doc(db, "users", currentUser.uid);
    const snap = await getDoc(ref);

    let oldCoins = snap.data().coins;
    let newCoins = oldCoins + 10;

    await updateDoc(ref, { coins: newCoins });

    if(attemptsLeft === 0){
        alert("All tasks completed for today!");
    }
}

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Task System Final Working</title>
<style>
body { margin:0; padding:0; font-family:Poppins, sans-serif; background:#e9f3ff; }
.topbar { width:100%; padding:15px 20px; background:#0066ff; color:white; font-size:22px; font-weight:bold; display:flex; justify-content:space-between; align-items:center; }
#coinBox { background:rgba(255,255,255,0.25); padding:6px 14px; border-radius:20px; font-size:18px; backdrop-filter:blur(6px); }
#limitBox { width:170px; margin:20px auto; background:#fff; padding:10px; font-size:20px; font-weight:bold; border-radius:10px; text-align:center; box-shadow:0 3px 8px rgba(0,0,0,0.2); }
#questionBox { width:85%; margin:20px auto; background:white; padding:25px; border-radius:15px; text-align:center; font-size:21px; box-shadow:0 3px 12px rgba(0,0,0,0.2); }
.optionBtn { width:90%; padding:12px; margin:10px auto; display:block; background:#007bff; border:none; color:white; font-size:18px; border-radius:10px; }
.screen { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; }
.popup { background:white; padding:20px; width:75%; border-radius:15px; text-align:center; font-size:22px; }
.btn { background:#007bff; border:none; padding:12px 20px; color:white; font-size:19px; border-radius:10px; margin-top:15px; }
</style>
</head>
<body>

<div class="topbar">TASK <div id="coinBox">ðŸª™ <span id="userCoins">0</span></div></div>
<div id="limitBox">0 / 15</div>

<div id="questionBox">
    <div id="questionText">Loading...</div>
    <button class="optionBtn" id="b0"></button>
    <button class="optionBtn" id="b1"></button>
    <button class="optionBtn" id="b2"></button>
    <button class="optionBtn" id="b3"></button>
</div>

<div id="correctScreen" class="screen">
    <div class="popup">âœ… Correct!<br><button class="btn" id="continueBtn">Continue</button></div>
</div>

<div id="adScreen" class="screen">
    <div class="popup">âŒ› Showing Ad...<br><button class="btn" id="adCloseBtn">Close Ad</button></div>
</div>

<div id="claimScreen" class="screen">
    <div class="popup">ðŸŽ‰ +10 Coins<br><button class="btn" id="claimBtn">Claim</button></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCBgBWfpUbtlPbvCfDr6N1_L2svtJglfhM",
  authDomain: "kssm-rock-tam-ad.firebaseapp.com",
  projectId: "kssm-rock-tam-ad",
  storageBucket: "kssm-rock-tam-ad.firebasestorage.app",
  messagingSenderId: "28268633766",
  appId: "1:28268633766:web:f6ee57eaf56f7cbd37de67"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let uid = null;
let count = 0;
const limit = 15;

const question = "What is 5 x 5?";
const options = ["20","25","35","30"];
const answer = 1;

document.getElementById("questionText").innerText = question;
options.forEach((t,i)=>document.getElementById("b"+i).innerText=t);

onAuthStateChanged(auth, async user => {
    if(!user) return;
    uid = user.uid;
    const ref = doc(db,"users",uid);
    let snap = await getDoc(ref);
    document.getElementById("userCoins").innerText = snap.data().coins;
});

[0,1,2,3].forEach(i=>{
    document.getElementById("b"+i).onclick = ()=>{
        if(i===answer){
            document.getElementById("correctScreen").style.display="flex";
        }
    };
});

document.getElementById("continueBtn").onclick = ()=>{
    document.getElementById("correctScreen").style.display="none";
    document.getElementById("adScreen").style.display="flex";
};

document.getElementById("adCloseBtn").onclick = ()=>{
    document.getElementById("adScreen").style.display="none";
    document.getElementById("claimScreen").style.display="flex";
};

document.getElementById("claimBtn").onclick = async ()=>{
    const ref = doc(db,"users",uid);
    await updateDoc(ref,{ coins: increment(10) });

    let c = parseInt(document.getElementById("userCoins").innerText);
    document.getElementById("userCoins").innerText = c + 10;

    count++;
    document.getElementById("limitBox").innerText = count+" / "+limit;

    document.getElementById("claimScreen").style.display="none";

    if(count>=limit){ alert("Task Completed!"); return; }
};
</script>
</body>
</html>

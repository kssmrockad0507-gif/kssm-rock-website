<!DOCTYPE html>
<html>
<head>
    <title>Redeem History</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        margin: 0;
        padding: 0;
        background: linear-gradient(180deg, #0e5d63, #07404b);
        font-family: Arial;
        color: white;
    }

    /* Top Bar */
    .topBar {
        width: 100%;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .backBtn {
        font-size: 30px;
        cursor: pointer;
    }

    .coinBox {
        background: white;
        color: black;
        padding: 6px 15px;
        border-radius: 20px;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .card {
        width: 90%;
        background: white;
        margin: auto;
        margin-top: 20px;
        border-radius: 25px;
        padding: 20px;
        color: black;
    }

    .historyItem {
        background: #d9e3e6;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
    }

    .noData {
        text-align: center;
        padding: 20px;
        font-size: 22px;
        color: white;
    }
</style>
</head>

<body>

<!-- ðŸ”™ TOP BAR -->
<div class="topBar">
    <div class="backBtn" onclick="goBack()">âŸµ</div>

    <div class="coinBox">
        <span id="coinValue">0</span> ðŸª™
    </div>
</div>

<!-- MAIN CARD -->
<div class="card">
    <h2 style="text-align:center;">Redeem History</h2>
    <div id="historyList"></div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”¥ Firebase Config */
const firebaseConfig = {
    apiKey: "AIzaSyCBgBWfpUbtlPbvCfDr6N1_L2svtJglfhM",
    authDomain: "kssm-rock-tam-ad.firebaseapp.com",
    projectId: "kssm-rock-tam-ad",
    storageBucket: "kssm-rock-tam-ad.firebasestorage.app",
    messagingSenderId: "28268633766",
    appId: "1:28268633766:web:f6ee57eaf56f7cbd37de67"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore(app);

/* ðŸ“Œ Back Button */
function goBack() {
    window.location.href = "Home.html";  // your home page file
}

/* ðŸ“Œ Load Coins & History */
onAuthStateChanged(auth, async (user) => {
    if (!user) {
        alert("Please login!");
        window.location.href = "login.html";
        return;
    }

    const userRef = doc(db, "users", user.uid);

    // Load Coins
    const userSnap = await getDoc(userRef);
    if (userSnap.exists()) {
        document.getElementById("coinValue").innerText = userSnap.data().coins || 0;
    }

    // Load Redeem History
    const hList = document.getElementById("historyList");
    hList.innerHTML = "";

    const historyRef = collection(db, "users", user.uid, "redeemHistory");
    const q = query(historyRef, orderBy("time", "desc"));

    const snap = await getDocs(q);

    if (snap.empty) {
        hList.innerHTML = `<div class='noData'>No Redeem History Available</div>`;
        return;
    }

    snap.forEach(docu => {
        let data = docu.data();

        hList.innerHTML += `
            <div class="historyItem">
                <b>Code: </b> ${data.code} <br>
                <b>Value: </b> ${data.value} coins <br>
                <b>Time: </b> ${new Date(data.time).toLocaleString()}
            </div>
        `;
    });
});
</script>

</body>
</html>
